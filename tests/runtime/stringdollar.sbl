// Test string-$.

externals (stem)

strings (s)

stringescapes {}

define stem as (
  $s=''
  $(lenof s == 0) or fail='setting s empty failed'

  $s='xyz'
  $(lenof s == 3) or fail='setting s failed'
  test ('ok' atlimit) or fail='setting s changed current string'

  test (next $s hop 2 $(cursor == 1)) or fail='cursor not restored after string-$'
  test (next $s hop 2 $(limit == 2)) or fail='limit not restored after string-$'

  test (next $s $(cursor == 0)) or fail='cursor not zeroed inside string-$'
  test (next $s $(limit == 3)) or fail='limit not reset inside string-$'

  (not $s fail ='news' test ('ok' atlimit)) or fail='current string not restored after failing string-$'
  test (next not $s fail (='news' next) $(cursor == 1)) or fail='cursor not restored after failing string-$'
  (not $s fail (='news' next) $(limit == 2)) or fail='limit not restored after failing string-$'
)
